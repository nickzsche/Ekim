{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 73, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Admin/Desktop/Ekim/src/lib/database.ts"],"sourcesContent":["import Database from 'better-sqlite3';\r\nimport path from 'path';\r\n\r\n// Veritabanı dosyasının yolu\r\nconst dbPath = path.join(process.cwd(), 'data', 'products.db');\r\n\r\n// Veritabanı bağlantısı\r\nlet db: Database.Database;\r\n\r\nexport function getDatabase() {\r\n  if (!db) {\r\n    // Data klasörü yoksa oluştur\r\n    const fs = require('fs');\r\n    const dataDir = path.dirname(dbPath);\r\n    if (!fs.existsSync(dataDir)) {\r\n      fs.mkdirSync(dataDir, { recursive: true });\r\n    }\r\n\r\n    db = new Database(dbPath);\r\n    \r\n    // Ürünler tablosunu oluştur\r\n    db.exec(`\r\n      CREATE TABLE IF NOT EXISTS products (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        name TEXT NOT NULL,\r\n        code TEXT UNIQUE,\r\n        brand TEXT,\r\n        model TEXT,\r\n        category TEXT,\r\n        price REAL,\r\n        description TEXT,\r\n        specifications TEXT,\r\n        stock_quantity INTEGER DEFAULT 0,\r\n        unit TEXT DEFAULT 'adet',\r\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\r\n      )\r\n    `);\r\n\r\n    // Müşteriler tablosunu oluştur\r\n    db.exec(`\r\n      CREATE TABLE IF NOT EXISTS customers (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        name TEXT NOT NULL,\r\n        email TEXT,\r\n        phone TEXT,\r\n        company TEXT,\r\n        address TEXT,\r\n        tax_number TEXT,\r\n        tax_office TEXT,\r\n        balance REAL DEFAULT 0,\r\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\r\n      )\r\n    `);\r\n\r\n    // Teklifler tablosunu oluştur\r\n    db.exec(`\r\n      CREATE TABLE IF NOT EXISTS quotes (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        customer_name TEXT NOT NULL,\r\n        customer_email TEXT,\r\n        customer_phone TEXT,\r\n        company TEXT,\r\n        total_amount REAL DEFAULT 0,\r\n        status TEXT DEFAULT 'draft',\r\n        notes TEXT,\r\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\r\n      )\r\n    `);\r\n\r\n    // Teklif kalemleri tablosunu oluştur\r\n    db.exec(`\r\n      CREATE TABLE IF NOT EXISTS quote_items (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        quote_id INTEGER NOT NULL,\r\n        product_id INTEGER NOT NULL,\r\n        quantity INTEGER NOT NULL,\r\n        unit_price REAL NOT NULL,\r\n        total_price REAL NOT NULL,\r\n        FOREIGN KEY (quote_id) REFERENCES quotes (id) ON DELETE CASCADE,\r\n        FOREIGN KEY (product_id) REFERENCES products (id)\r\n      )\r\n    `);\r\n\r\n    // Cari hareketler tablosunu oluştur\r\n    db.exec(`\r\n      CREATE TABLE IF NOT EXISTS transactions (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        customer_id INTEGER NOT NULL,\r\n        date TEXT NOT NULL,\r\n        type TEXT NOT NULL CHECK(type IN ('tahsilat', 'ödeme', 'çek', 'borç')),\r\n        method TEXT NOT NULL CHECK(method IN ('nakit', 'kredi', 'çek', 'manuel')),\r\n        amount REAL NOT NULL,\r\n        description TEXT,\r\n        verilis_tarihi TEXT,\r\n        vade_tarihi TEXT,\r\n        bank TEXT,\r\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n        FOREIGN KEY (customer_id) REFERENCES customers (id) ON DELETE CASCADE\r\n      )\r\n    `);\r\n\r\n    // Eğer customers tablosunda balance kolonu yoksa ekle\r\n    const tableInfo = db.prepare(\"PRAGMA table_info(customers)\").all();\r\n    const hasBalance = (tableInfo as any[]).some((col: any) => col.name === 'balance');\r\n    if (!hasBalance) {\r\n      db.exec(`ALTER TABLE customers ADD COLUMN balance REAL DEFAULT 0`);\r\n    }\r\n\r\n    // Tanımlı projeler tablosunu oluştur\r\n    db.exec(`\r\n      CREATE TABLE IF NOT EXISTS projects (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        name TEXT NOT NULL,\r\n        description TEXT,\r\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\r\n      )\r\n    `);\r\n\r\n    // Tedarikçiler tablosunu oluştur\r\n    db.exec(`\r\n      CREATE TABLE IF NOT EXISTS suppliers (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        name TEXT NOT NULL,\r\n        description TEXT,\r\n        contact_name TEXT,\r\n        email TEXT,\r\n        phone TEXT,\r\n        address TEXT,\r\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\r\n      )\r\n    `);\r\n\r\n    // Products tablosuna supplier_id kolonu ekle (yoksa)\r\n    const productsTableInfo = db.prepare(\"PRAGMA table_info(products)\").all();\r\n    const hasSupplierId = (productsTableInfo as any[]).some((col: any) => col.name === 'supplier_id');\r\n    if (!hasSupplierId) {\r\n      db.exec(`ALTER TABLE products ADD COLUMN supplier_id INTEGER REFERENCES suppliers(id)`);\r\n    }\r\n\r\n    // Proje grupları tablosunu oluştur (kategoriler)\r\n    db.exec(`\r\n      CREATE TABLE IF NOT EXISTS project_groups (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        project_id INTEGER NOT NULL,\r\n        name TEXT NOT NULL,\r\n        sort_order INTEGER DEFAULT 0,\r\n        FOREIGN KEY (project_id) REFERENCES projects (id) ON DELETE CASCADE\r\n      )\r\n    `);\r\n\r\n    // Proje ürünleri tablosunu oluştur\r\n    db.exec(`\r\n      CREATE TABLE IF NOT EXISTS project_items (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        project_id INTEGER NOT NULL,\r\n        group_id INTEGER,\r\n        product_id INTEGER NOT NULL,\r\n        product_name TEXT NOT NULL,\r\n        quantity INTEGER DEFAULT 1,\r\n        unit_price REAL DEFAULT 0,\r\n        discount REAL DEFAULT 0,\r\n        margin REAL DEFAULT 0,\r\n        sales_price REAL DEFAULT 0,\r\n        square_meters REAL DEFAULT 0,\r\n        sort_order INTEGER DEFAULT 0,\r\n        FOREIGN KEY (project_id) REFERENCES projects (id) ON DELETE CASCADE,\r\n        FOREIGN KEY (group_id) REFERENCES project_groups (id) ON DELETE SET NULL,\r\n        FOREIGN KEY (product_id) REFERENCES products (id)\r\n      )\r\n    `);\r\n  }\r\n  \r\n  return db;\r\n}\r\n\r\n// Ürün tipi\r\nexport interface Product {\r\n  id: number;\r\n  name: string;\r\n  code?: string;\r\n  brand?: string;\r\n  model?: string;\r\n  category?: string;\r\n  price?: number;\r\n  description?: string;\r\n  specifications?: string;\r\n  stock_quantity?: number;\r\n  unit?: string;\r\n  created_at?: string;\r\n  updated_at?: string;\r\n}\r\n\r\n// Müşteri tipi\r\nexport interface Customer {\r\n  id?: number;\r\n  name: string;\r\n  email?: string;\r\n  phone?: string;\r\n  company?: string;\r\n  address?: string;\r\n  tax_number?: string;\r\n  tax_office?: string;\r\n  balance?: number;\r\n  created_at?: string;\r\n  updated_at?: string;\r\n}\r\n\r\n// Cari hareket tipi\r\nexport interface Transaction {\r\n  id?: number;\r\n  customer_id: number;\r\n  date: string;\r\n  type: 'tahsilat' | 'ödeme' | 'çek' | 'borç';\r\n  method: 'nakit' | 'kredi' | 'çek' | 'manuel';\r\n  amount: number;\r\n  description?: string;\r\n  verilis_tarihi?: string;\r\n  vade_tarihi?: string;\r\n  bank?: string;\r\n  created_at?: string;\r\n}\r\n\r\n// Teklif tipi\r\nexport interface Quote {\r\n  id?: number;\r\n  customer_name: string;\r\n  customer_email?: string;\r\n  customer_phone?: string;\r\n  company?: string;\r\n  total_amount?: number;\r\n  status?: string;\r\n  notes?: string;\r\n  created_at?: string;\r\n  updated_at?: string;\r\n}\r\n\r\n// Teklif kalemi tipi\r\nexport interface QuoteItem {\r\n  id?: number;\r\n  quote_id: number;\r\n  product_id: number;\r\n  quantity: number;\r\n  unit_price: number;\r\n  total_price: number;\r\n}\r\n\r\n// Tanımlı proje tipi\r\nexport interface Project {\r\n  id?: number;\r\n  name: string;\r\n  description?: string;\r\n  created_at?: string;\r\n  updated_at?: string;\r\n}\r\n\r\n// Proje grubu tipi\r\nexport interface ProjectGroup {\r\n  id?: number;\r\n  project_id: number;\r\n  name: string;\r\n  sort_order?: number;\r\n}\r\n\r\n// Proje ürün tipi\r\nexport interface ProjectItem {\r\n  id?: number;\r\n  project_id: number;\r\n  group_id?: number;\r\n  product_id: number;\r\n  product_name: string;\r\n  quantity: number;\r\n  unit_price: number;\r\n  discount: number;\r\n  margin: number;\r\n  sales_price: number;\r\n  square_meters: number;\r\n  sort_order?: number;\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,6BAA6B;AAC7B,MAAM,SAAS,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ;AAEhD,wBAAwB;AACxB,IAAI;AAEG,SAAS;IACd,IAAI,CAAC,IAAI;QACP,6BAA6B;QAC7B,MAAM;QACN,MAAM,UAAU,4GAAI,CAAC,OAAO,CAAC;QAC7B,IAAI,CAAC,GAAG,UAAU,CAAC,UAAU;YAC3B,GAAG,SAAS,CAAC,SAAS;gBAAE,WAAW;YAAK;QAC1C;QAEA,KAAK,IAAI,sIAAQ,CAAC;QAElB,4BAA4B;QAC5B,GAAG,IAAI,CAAC,CAAC;;;;;;;;;;;;;;;;IAgBT,CAAC;QAED,+BAA+B;QAC/B,GAAG,IAAI,CAAC,CAAC;;;;;;;;;;;;;;IAcT,CAAC;QAED,8BAA8B;QAC9B,GAAG,IAAI,CAAC,CAAC;;;;;;;;;;;;;IAaT,CAAC;QAED,qCAAqC;QACrC,GAAG,IAAI,CAAC,CAAC;;;;;;;;;;;IAWT,CAAC;QAED,oCAAoC;QACpC,GAAG,IAAI,CAAC,CAAC;;;;;;;;;;;;;;;IAeT,CAAC;QAED,sDAAsD;QACtD,MAAM,YAAY,GAAG,OAAO,CAAC,gCAAgC,GAAG;QAChE,MAAM,aAAa,AAAC,UAAoB,IAAI,CAAC,CAAC,MAAa,IAAI,IAAI,KAAK;QACxE,IAAI,CAAC,YAAY;YACf,GAAG,IAAI,CAAC,CAAC,uDAAuD,CAAC;QACnE;QAEA,qCAAqC;QACrC,GAAG,IAAI,CAAC,CAAC;;;;;;;;IAQT,CAAC;QAED,iCAAiC;QACjC,GAAG,IAAI,CAAC,CAAC;;;;;;;;;;;;IAYT,CAAC;QAED,qDAAqD;QACrD,MAAM,oBAAoB,GAAG,OAAO,CAAC,+BAA+B,GAAG;QACvE,MAAM,gBAAgB,AAAC,kBAA4B,IAAI,CAAC,CAAC,MAAa,IAAI,IAAI,KAAK;QACnF,IAAI,CAAC,eAAe;YAClB,GAAG,IAAI,CAAC,CAAC,4EAA4E,CAAC;QACxF;QAEA,iDAAiD;QACjD,GAAG,IAAI,CAAC,CAAC;;;;;;;;IAQT,CAAC;QAED,mCAAmC;QACnC,GAAG,IAAI,CAAC,CAAC;;;;;;;;;;;;;;;;;;IAkBT,CAAC;IACH;IAEA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 248, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Admin/Desktop/Ekim/src/app/api/products/%5Bid%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { getDatabase, Product } from '@/lib/database';\r\n\r\nexport async function PUT(request: NextRequest, { params }: { params: { id: string } }) {\r\n  try {\r\n    const productId = parseInt(params.id);\r\n    if (isNaN(productId)) {\r\n      return NextResponse.json(\r\n        { error: 'Geçersiz ürün ID' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const updates: Partial<Product> = await request.json();\r\n    const db = getDatabase();\r\n    \r\n    // Güncellenebilir alanları kontrol et\r\n    const allowedFields = ['name', 'code', 'brand', 'model', 'category', 'price', 'description', 'specifications', 'stock_quantity', 'unit', 'supplier_id'];\r\n    const updateFields = Object.keys(updates).filter(key => allowedFields.includes(key));\r\n    \r\n    if (updateFields.length === 0) {\r\n      return NextResponse.json(\r\n        { error: 'Güncellenecek alan bulunamadı' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    \r\n    // SQL sorgusu oluştur\r\n    const setClause = updateFields.map(field => `${field} = ?`).join(', ');\r\n    const values = updateFields.map(field => updates[field as keyof Product]);\r\n    values.push(productId);\r\n    \r\n    const stmt = db.prepare(`\r\n      UPDATE products \r\n      SET ${setClause}, updated_at = CURRENT_TIMESTAMP\r\n      WHERE id = ?\r\n    `);\r\n    \r\n    const result = stmt.run(...values);\r\n    \r\n    if (result.changes === 0) {\r\n      return NextResponse.json(\r\n        { error: 'Ürün bulunamadı' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n    \r\n    // Güncellenmiş ürünü getir\r\n    const updatedProduct = db.prepare('SELECT * FROM products WHERE id = ?').get(productId);\r\n    \r\n    return NextResponse.json({\r\n      message: 'Ürün başarıyla güncellendi',\r\n      product: updatedProduct\r\n    });\r\n    \r\n  } catch (error) {\r\n    console.error('Ürün güncelleme hatası:', error);\r\n    return NextResponse.json(\r\n      { error: 'Ürün güncellenirken hata oluştu' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function DELETE(request: NextRequest, { params }: { params: { id: string } }) {\r\n  try {\r\n    const productId = parseInt(params.id);\r\n    if (isNaN(productId)) {\r\n      return NextResponse.json(\r\n        { error: 'Geçersiz ürün ID' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const db = getDatabase();\r\n    const stmt = db.prepare('DELETE FROM products WHERE id = ?');\r\n    const result = stmt.run(productId);\r\n    \r\n    if (result.changes === 0) {\r\n      return NextResponse.json(\r\n        { error: 'Ürün bulunamadı' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n    \r\n    return NextResponse.json({\r\n      message: 'Ürün başarıyla silindi'\r\n    });\r\n    \r\n  } catch (error) {\r\n    console.error('Ürün silme hatası:', error);\r\n    return NextResponse.json(\r\n      { error: 'Ürün silinirken hata oluştu' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest, { params }: { params: { id: string } }) {\r\n  try {\r\n    const productId = parseInt(params.id);\r\n    if (isNaN(productId)) {\r\n      return NextResponse.json(\r\n        { error: 'Geçersiz ürün ID' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const db = getDatabase();\r\n    const product = db.prepare('SELECT * FROM products WHERE id = ?').get(productId);\r\n    \r\n    if (!product) {\r\n      return NextResponse.json(\r\n        { error: 'Ürün bulunamadı' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n    \r\n    return NextResponse.json(product);\r\n    \r\n  } catch (error) {\r\n    console.error('Ürün getirme hatası:', error);\r\n    return NextResponse.json(\r\n      { error: 'Ürün getirilirken hata oluştu' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}