{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 79, "column": 0}, "map": {"version":3,"sources":["file:///home/FarukAbi/Ekim/src/app/api/quotes/%5Bid%5D/download-pdf/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport puppeteer from 'puppeteer';\nimport Database from 'better-sqlite3';\nimport path from 'path';\n\nconst dbPath = path.join(process.cwd(), 'database.db');\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const db = new Database(dbPath);\n    const quoteId = parseInt(params.id);\n\n    // Teklif verisini √ßek\n    const quote = db.prepare(`\n      SELECT q.*, c.name as customer_name, c.company, c.email, c.phone\n      FROM quotes q\n      LEFT JOIN customers c ON q.customer_id = c.id\n      WHERE q.id = ?\n    `).get(quoteId) as any;\n\n    if (!quote) {\n      return NextResponse.json({ error: 'Teklif bulunamadƒ±' }, { status: 404 });\n    }\n\n    // Teklif kalemlerini √ßek\n    const items = db.prepare(`\n      SELECT qi.*, p.name, p.code, p.brand, p.model\n      FROM quote_items qi\n      LEFT JOIN products p ON qi.product_id = p.id\n      WHERE qi.quote_id = ?\n    `).all(quoteId);\n\n    db.close();\n\n    // HTML i√ßeriƒüini olu≈ütur\n    const htmlContent = generateHTML(quote, items);\n\n    // Puppeteer ile PDF olu≈ütur\n    const browser = await puppeteer.launch({\n      headless: true,\n      args: ['--no-sandbox', '--disable-setuid-sandbox']\n    });\n\n    const page = await browser.newPage();\n    await page.setContent(htmlContent, { waitUntil: 'networkidle0' });\n\n    const pdf = await page.pdf({\n      format: 'A4',\n      printBackground: true,\n      margin: {\n        top: '15mm',\n        bottom: '15mm',\n        left: '15mm',\n        right: '15mm'\n      }\n    });\n\n    await browser.close();\n\n    // PDF'i indir\n    return new NextResponse(Buffer.from(pdf), {\n      headers: {\n        'Content-Type': 'application/pdf',\n        'Content-Disposition': `attachment; filename=\"Teklif-${quoteId}-${quote.customer_name?.replace(/[^a-zA-Z0-9]/g, '_') || 'Musteri'}.pdf\"`\n      }\n    });\n\n  } catch (error) {\n    console.error('PDF olu≈üturma hatasƒ±:', error);\n    return NextResponse.json({ error: 'PDF olu≈üturulamadƒ±' }, { status: 500 });\n  }\n}\n\nfunction generateHTML(quote: any, items: any[]): string {\n  const projectDetails = JSON.parse(quote.project_details || '{}');\n  const schedule = JSON.parse(quote.schedule || '{}');\n  const conditions = JSON.parse(quote.conditions || '{}');\n\n  return `\n<!DOCTYPE html>\n<html lang=\"tr\">\n<head>\n  <meta charset=\"UTF-8\">\n  <style>\n    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');\n    \n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    \n    body {\n      font-family: 'Inter', -apple-system, sans-serif;\n      color: #1a202c;\n      line-height: 1.6;\n    }\n    \n    .header {\n      background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);\n      padding: 40px;\n      color: white;\n      -webkit-print-color-adjust: exact;\n      print-color-adjust: exact;\n    }\n    \n    .header-content {\n      display: grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 40px;\n    }\n    \n    .company-section h1 {\n      font-size: 11px;\n      font-weight: 600;\n      margin-bottom: 5px;\n      letter-spacing: 1px;\n    }\n    \n    .company-section p {\n      font-size: 13px;\n      font-weight: 500;\n      margin-bottom: 15px;\n    }\n    \n    .company-contacts {\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n      font-size: 11px;\n    }\n    \n    .customer-section {\n      background: rgba(255, 255, 255, 0.15);\n      border: 2px solid rgba(255, 255, 255, 0.3);\n      border-radius: 16px;\n      padding: 24px;\n      -webkit-print-color-adjust: exact;\n      print-color-adjust: exact;\n    }\n    \n    .customer-section h2 {\n      font-size: 11px;\n      font-weight: 600;\n      text-transform: uppercase;\n      letter-spacing: 1.5px;\n      margin-bottom: 16px;\n    }\n    \n    .customer-name {\n      font-size: 24px;\n      font-weight: 800;\n      margin-bottom: 16px;\n    }\n    \n    .customer-details {\n      display: flex;\n      flex-direction: column;\n      gap: 10px;\n    }\n    \n    .customer-detail {\n      font-size: 13px;\n      font-weight: 500;\n    }\n    \n    .quote-meta {\n      margin-top: 16px;\n      padding-top: 16px;\n      border-top: 1px solid rgba(255, 255, 255, 0.2);\n      display: grid;\n      grid-template-columns: repeat(2, 1fr);\n      gap: 12px;\n      font-size: 11px;\n    }\n    \n    .quote-meta-item strong {\n      display: block;\n      font-weight: 600;\n      opacity: 0.8;\n      font-size: 10px;\n    }\n    \n    .quote-meta-item span {\n      font-weight: 700;\n      font-size: 13px;\n    }\n    \n    .content {\n      padding: 40px;\n    }\n    \n    .project-details {\n      background: #f8fafc;\n      border-radius: 12px;\n      padding: 28px;\n      margin-bottom: 32px;\n      border: 1px solid #e2e8f0;\n    }\n    \n    .project-title {\n      font-size: 16px;\n      color: #1e293b;\n      font-weight: 700;\n      margin-bottom: 20px;\n    }\n    \n    .project-info-grid {\n      display: grid;\n      grid-template-columns: repeat(2, 1fr);\n      gap: 20px;\n      margin-bottom: 20px;\n    }\n    \n    .info-item {\n      display: flex;\n      flex-direction: column;\n      gap: 6px;\n    }\n    \n    .info-label {\n      font-size: 11px;\n      font-weight: 600;\n      color: #64748b;\n      text-transform: uppercase;\n    }\n    \n    .info-value {\n      font-size: 14px;\n      font-weight: 600;\n      color: #1e293b;\n    }\n    \n    .items-section-title {\n      font-size: 18px;\n      font-weight: 700;\n      color: #1e293b;\n      margin-bottom: 20px;\n    }\n    \n    table {\n      width: 100%;\n      border-collapse: separate;\n      border-spacing: 0;\n      margin-bottom: 24px;\n    }\n    \n    .items-table {\n      border-radius: 12px;\n      overflow: hidden;\n      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n    }\n    \n    .items-table thead {\n      background: linear-gradient(135deg, #1e40af 0%, #2563eb 100%);\n      color: white;\n      -webkit-print-color-adjust: exact;\n      print-color-adjust: exact;\n    }\n    \n    .items-table th {\n      padding: 16px;\n      text-align: left;\n      font-size: 12px;\n      font-weight: 600;\n      text-transform: uppercase;\n    }\n    \n    .items-table tbody tr {\n      border-bottom: 1px solid #e2e8f0;\n    }\n    \n    .items-table td {\n      padding: 18px 16px;\n      font-size: 13px;\n      color: #334155;\n    }\n    \n    .product-name {\n      font-weight: 600;\n      color: #1e293b;\n      font-size: 14px;\n      margin-bottom: 4px;\n    }\n    \n    .product-meta {\n      font-size: 11px;\n      color: #64748b;\n      margin-top: 4px;\n    }\n    \n    .total-section {\n      margin-top: 32px;\n      padding: 24px;\n      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\n      border-radius: 12px;\n      border: 1px solid #e2e8f0;\n      -webkit-print-color-adjust: exact;\n      print-color-adjust: exact;\n    }\n    \n    .total-row {\n      display: flex;\n      justify-content: space-between;\n      padding: 10px 0;\n      font-size: 14px;\n    }\n    \n    .total-row.subtotal {\n      border-bottom: 1px solid #cbd5e1;\n      padding-bottom: 16px;\n      margin-bottom: 12px;\n    }\n    \n    .total-row.grand-total {\n      border-top: 2px solid #2563eb;\n      padding-top: 16px;\n      margin-top: 12px;\n      font-size: 18px;\n      font-weight: 700;\n    }\n    \n    .total-row.grand-total span {\n      color: #2563eb;\n      font-size: 22px;\n    }\n    \n    .signature-section {\n      margin-top: 60px;\n      display: grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 60px;\n      padding: 32px 0;\n      border-top: 2px solid #e2e8f0;\n    }\n    \n    .signature-label {\n      font-size: 13px;\n      font-weight: 600;\n      color: #475569;\n      margin-bottom: 20px;\n    }\n    \n    .signature-line {\n      border-top: 2px solid #cbd5e1;\n      padding-top: 12px;\n      min-width: 220px;\n      font-size: 13px;\n      font-weight: 600;\n    }\n    \n    .footer {\n      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);\n      color: white;\n      padding: 32px;\n      text-align: center;\n      -webkit-print-color-adjust: exact;\n      print-color-adjust: exact;\n    }\n    \n    .footer-content {\n      display: flex;\n      justify-content: center;\n      gap: 24px;\n      margin-bottom: 16px;\n      font-size: 12px;\n    }\n    \n    .footer-copyright {\n      font-size: 11px;\n      opacity: 0.7;\n    }\n  </style>\n</head>\n<body>\n  <div class=\"header\">\n    <div class=\"header-content\">\n      <div class=\"company-section\">\n        <h1>MET GRUP MARKASIDIR</h1>\n        <p>Profesyonel Soƒüutma ve Klima Sistemleri</p>\n        <div class=\"company-contacts\">\n          <div>üìû +90 542 457 2553</div>\n          <div>‚úâÔ∏è info@ekimsogutma.com</div>\n          <div>üåê www.ekimsogutma.com</div>\n        </div>\n      </div>\n      \n      <div class=\"customer-section\">\n        <h2>M√ú≈ûTERƒ∞ Bƒ∞LGƒ∞LERƒ∞</h2>\n        <div class=\"customer-name\">${quote.customer_name || 'M√ú≈ûTERƒ∞ ADI'}</div>\n        <div class=\"customer-details\">\n          ${quote.company ? `<div class=\"customer-detail\">üè¢ ${quote.company}</div>` : ''}\n          ${quote.phone ? `<div class=\"customer-detail\">üìû ${quote.phone}</div>` : ''}\n          ${quote.email ? `<div class=\"customer-detail\">‚úâÔ∏è ${quote.email}</div>` : ''}\n        </div>\n        <div class=\"quote-meta\">\n          <div class=\"quote-meta-item\">\n            <strong>TEKLƒ∞F NO</strong>\n            <span>#${quote.id}</span>\n          </div>\n          <div class=\"quote-meta-item\">\n            <strong>TARƒ∞H</strong>\n            <span>${new Date(quote.created_at).toLocaleDateString('tr-TR')}</span>\n          </div>\n          <div class=\"quote-meta-item\">\n            <strong>GE√áERLƒ∞Lƒ∞K</strong>\n            <span>${conditions.validityPeriod || '-'} G√ºn</span>\n          </div>\n          <div class=\"quote-meta-item\">\n            <strong>TESLƒ∞MAT</strong>\n            <span>${conditions.deliveryTime || '-'}</span>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"content\">\n    <div class=\"project-details\">\n      <div class=\"project-title\">üìã Proje Detaylarƒ±</div>\n      <div class=\"project-info-grid\">\n        <div class=\"info-item\">\n          <div class=\"info-label\">Proje Konusu</div>\n          <div class=\"info-value\">${projectDetails.projectDesign || '-'}</div>\n        </div>\n        <div class=\"info-item\">\n          <div class=\"info-label\">Teslimat S√ºresi</div>\n          <div class=\"info-value\">${conditions.deliveryTime || '-'}</div>\n        </div>\n        <div class=\"info-item\">\n          <div class=\"info-label\">Ba≈ülangƒ±√ß Tarihi</div>\n          <div class=\"info-value\">${schedule.startDate ? new Date(schedule.startDate).toLocaleDateString('tr-TR') : '-'}</div>\n        </div>\n        <div class=\"info-item\">\n          <div class=\"info-label\">Biti≈ü Tarihi</div>\n          <div class=\"info-value\">${schedule.endDate ? new Date(schedule.endDate).toLocaleDateString('tr-TR') : '-'}</div>\n        </div>\n      </div>\n    </div>\n\n    <div>\n      <div class=\"items-section-title\">üì¶ Teklif Kalemleri</div>\n      <table class=\"items-table\">\n        <thead>\n          <tr>\n            <th>√úr√ºn Bilgisi</th>\n            <th style=\"text-align: center; width: 100px;\">Miktar</th>\n            <th style=\"text-align: right; width: 140px;\">Birim Fiyat</th>\n            <th style=\"text-align: right; width: 140px;\">Toplam</th>\n          </tr>\n        </thead>\n        <tbody>\n          ${items.map(item => `\n            <tr>\n              <td>\n                <div class=\"product-name\">${item.custom_name || item.name}</div>\n                ${item.brand || item.model ? `<div class=\"product-meta\">${item.brand || ''} ${item.model || ''}</div>` : ''}\n                ${item.code ? `<div class=\"product-meta\">Kod: ${item.code}</div>` : ''}\n              </td>\n              <td style=\"text-align: center; font-weight: 700; color: #2563eb;\">${item.quantity}</td>\n              <td style=\"text-align: right; font-weight: 600; color: #059669;\">‚Ç¨${parseFloat(item.unit_price).toLocaleString('tr-TR', { minimumFractionDigits: 2 })}</td>\n              <td style=\"text-align: right; font-weight: 700; font-size: 14px;\">‚Ç¨${parseFloat(item.total).toLocaleString('tr-TR', { minimumFractionDigits: 2 })}</td>\n            </tr>\n          `).join('')}\n        </tbody>\n      </table>\n      \n      <div class=\"total-section\">\n        <div class=\"total-row subtotal\">\n          <strong>Ara Toplam</strong>\n          <span>‚Ç¨${items.reduce((sum, item) => sum + parseFloat(item.total), 0).toLocaleString('tr-TR', { minimumFractionDigits: 2 })}</span>\n        </div>\n        <div class=\"total-row\">\n          <strong>KDV (%20)</strong>\n          <span>‚Ç¨${(items.reduce((sum, item) => sum + parseFloat(item.total), 0) * 0.2).toLocaleString('tr-TR', { minimumFractionDigits: 2 })}</span>\n        </div>\n        <div class=\"total-row grand-total\">\n          <strong>GENEL TOPLAM</strong>\n          <span>‚Ç¨${(items.reduce((sum, item) => sum + parseFloat(item.total), 0) * 1.2).toLocaleString('tr-TR', { minimumFractionDigits: 2 })}</span>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"signature-section\">\n      <div>\n        <div class=\"signature-label\">Ekim Soƒüutma</div>\n      </div>\n      <div>\n        <div class=\"signature-label\">M√º≈üteri Onayƒ±</div>\n        <div class=\"signature-line\">ƒ∞mza & Ka≈üe</div>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"footer\">\n    <div class=\"footer-content\">\n      <div>üåê www.ekimsogutma.com</div>\n      <div>‚úâÔ∏è info@ekimsogutma.com</div>\n      <div>üìû +90 542 457 2553</div>\n    </div>\n    <div class=\"footer-copyright\">¬© ${new Date().getFullYear()} Ekim Soƒüutma. T√ºm haklarƒ± saklƒ±dƒ±r.</div>\n  </div>\n</body>\n</html>\n  `;\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}